#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

data_directory = '/var/lib/postgresql/data'       # Папка, где хранятся данные PostgreSQL (таблицы, индексы и т.д.).
hba_file = '/etc/postgresql/conf/pg_hba.conf'     # Файл с настройками аутентификации пользователей.
ident_file = 'ConfigDir/pg_ident.conf'            # Файл, сопоставляющий системных и PostgreSQL-пользователей.
external_pid_file = ''                            # PID-файл для внешних процессов. Если пусто, файл не создается.

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

listen_addresses = '*'                  # IP-адреса для прослушивания соединений. '*' разрешает подключение с любых адресов.
port = 5432                             # TCP-порт для входящих соединений. Значение по умолчанию — 5432.
max_connections = 100                   # Максимальное число одновременных соединений с сервером.
password_encryption = scram-sha-256     # более безопасное хеширование паролей

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

shared_buffers = 200MB                  # Память для кэширования данных. Рекомендуется 25–40% от доступной ОЗУ.
work_mem = 64MB                         # Память для сортировок/хэш-операций. Используется на каждый процесс.
maintenance_work_mem = 512MB            # Память для операций VACUUM, CREATE INDEX и других задач.

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG (WAL)
#------------------------------------------------------------------------------

wal_level = replica                     # Уровень детализации WAL. 'replica' включает репликацию.
wal_buffers = 16MB                      # Размер памяти для записи WAL. Влияет на производительность больших транзакций.
max_wal_size = 1GB                      # Максимальный размер WAL перед контрольной точкой.
checkpoint_timeout = 10min              # Интервал между контрольными точками (обновление диска).

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

autovacuum = on                         # Автоматическая очистка таблиц от "мертвых" данных.
autovacuum_vacuum_threshold = 50        # Минимальное число изменённых строк, чтобы запускался VACUUM.
autovacuum_analyze_threshold = 50       # Минимальное число изменённых строк, чтобы запускался анализ статистики.
autovacuum_max_workers = 3              # Максимальное количество процессов автоваукума.
autovacuum_naptime = 1min               # Интервал между запуском процессов очистки.

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

effective_cache_size = 4GB              # Примерный объем доступной памяти для кэша операционной системы.
random_page_cost = 4.0                  # Относительная стоимость случайного доступа к странице по сравнению с последовательным.
seq_page_cost = 1.0                     # Стоимость последовательного доступа к странице. Обычно оставляют 1.

#------------------------------------------------------------------------------
# PARALLELISM
#------------------------------------------------------------------------------

max_worker_processes = 8                # Максимальное количество рабочих процессов для сервера.
max_parallel_workers = 8                # Максимальное количество процессов для параллельных запросов.

#------------------------------------------------------------------------------
# REPORTING AND LOGGING
#------------------------------------------------------------------------------

log_destination = 'stderr'              # Тип логирования. Возможные варианты: stderr, csvlog, jsonlog и т.д.
logging_collector = off                 # Включение сбора логов в файлы. Удобно для анализа на сервере.
log_directory = 'log'                   # Папка для хранения файлов логов.
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # Шаблон имени лог-файла.
log_min_messages = warning              # Минимальный уровень записываемых сообщений (например, ошибки).
log_min_duration_statement = 1000       # Логировать запросы, выполняющиеся дольше 1 секунды (в миллисекундах).

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

client_min_messages = notice            # Минимальный уровень сообщений для клиентов.
timezone = 'Europe/Moscow'              # Часовой пояс сервера установлен на Москву (UTC+3).
datestyle = 'iso, mdy'                  # Формат даты и времени. 'iso' — ISO 8601, 'mdy' — месяц/день/год.

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

deadlock_timeout = 1s                   # Время ожидания перед определением взаимной блокировки (deadlock).
max_locks_per_transaction = 64          # Максимальное количество блокировок для одной транзакции.

#------------------------------------------------------------------------------
# ERROR HANDLING
#------------------------------------------------------------------------------

exit_on_error = off                     # Завершать ли сессию при возникновении ошибки.
restart_after_crash = on                # Автоматический перезапуск сервера после сбоя.

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------

# Добавляем сюда свои кастомные параметры, если это нужно.
